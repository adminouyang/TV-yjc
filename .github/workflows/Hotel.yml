name: Hotel

on:
  schedule:
    - cron: '0 10,23 * * *'
  workflow_dispatch:

permissions:
  contents: write
  
env:
  TZ: 'Asia/Shanghai'

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: å¼ºåˆ¶æ›´æ–°åˆ°æœ€æ–°
        run: |
          git fetch origin
          git reset --hard origin/main
          echo "å·²æ›´æ–°åˆ°æœ€æ–°ä»£ç "

      - name: è®¾ç½® Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: å®‰è£…ä¾èµ–
        run: |
          pip install -r Hotel/requirements.txt
      
      - name: è·å–é…’åº—æº
        run: python Hotel/hotel.py

      - name: æäº¤æ›´æ”¹
        run: |
          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"
          
          git add -A
          
          if git diff --cached --quiet; then
            echo "æ²¡æœ‰æ£€æµ‹åˆ°æ›´æ”¹"
            exit 0
          fi
          
          git commit -m "ğŸ“º æ›´æ–°é…’åº—æº $(date '+%Y-%m-%d %H:%M:%S')"

      - name: å¼ºåˆ¶æ¨é€
        run: |
          # å†æ¬¡æ‹‰å–æœ€æ–°
          git fetch origin
          
          # ä½¿ç”¨å¸¦ç§Ÿçº¦çš„å¼ºåˆ¶æ¨é€ï¼Œæ›´å®‰å…¨
          git push origin main --force-with-lease
          
          echo "âœ… æ¨é€å®Œæˆ"
